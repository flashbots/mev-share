# event-stream

Events on MEV-Share are distributed via an SSE endpoint. Searchers listen to this endpoint to receive a stream of new events, which contain data they can use in their bundles.

<!-- TOC -->
* [event-stream](#event-stream)
  * [Event Scheme](#event-scheme)
    * [`hash`](#hash)
    * [`logs`](#logs)
    * [`tx`](#tx)
    * [`mevGasPrice`](#mevGasPrice)
    * [`gasUsed`](#gasUsed)
    * [Stream Logic](#stream-logic)
<!-- TOC -->

## Event Scheme

```typescript
{
    hash: string,
    logs?: LogParams[],
    txs: Array<{
        to?: string,
        functionSelector?: string,
        callData?: string,
    }>,
    mevGasPrice: string,
    gasUsed: string
}
```

_NOTE: Optional fields are marked with a `?`._

### `hash`

Hex-string of the transaction or bundle hash.

### `logs`

Array of JSON-encoded event logs emitted by executing the transaction.

### `tx`

Transactions from the event. If the event itself is a transaction, txs will only have one entry. Bundle events may have more.

| Field | Type | Description |
| `to` | Hex-string | Transaction recipient address. |
| `functionSelector` | Hex-string | 4-byte function selector. |
| `callData` | Hex-string | Calldata of the transaction. |

### `mevGasPrice`

The hex-string of the MEV gas price paid by the transaction is rounded up to the three most significant digits.

The MEV gas price is calculated as the change in the coinbase value after inserting the bundle, divided by the gas used.

The MEV gas price can be used to determine the minimum payment to the builder to make your backrun look more profitable 
to the builder than the original bundle without your backrun. Note that this only applies to builders 
like Flashbots who order bundles by their MEV gas price.

Here's how to determine the minimum tip and coinbase payment of your backrun 
in order to have a higher MEV gas price than the original bundle:
```text
mgp - MEV gas price of the original bundle (from the hint event)
t   - tip fee per gas of the backrun transaction
c   - coinbase payment of the backrun transaction
g   - gas used by the backrun transaction
gk  - gas used to pay kickback to the user (usually its 21000)

(g * t + c) / (g + gk) > mgp
```
1. If the backrun does not pay a tip:
```text
c > mgp * (g + gk)
```
2. If the backrun does not pay to the coinbase:
```text
t > mgp * (g + gk) / g
```

### `gasUsed`

Hex-string of the gas used by the transaction rounded up to the 2 most significant digits.

### Stream Logic

Users subscribe to the stream by making an HTTP GET request on the stream endpoint.

The endpoint should send an event with the message `:ping` every 15 seconds if no other messages were sent in the last 15 seconds.
